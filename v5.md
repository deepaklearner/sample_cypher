from neo4j import GraphDatabase
import csv

# Set up the Neo4j database connection
uri = "bolt://localhost:7687"  # Adjust for your setup
username = "neo4j"
password = "password"
driver = GraphDatabase.driver(uri, auth=(username, password))

# Create a session
session = driver.session()

# Cypher query to fetch data (adjust this to your needs)
query = "MATCH (n:Person) RETURN n.name AS name, n.age AS age LIMIT 10"

# Run the query and get the results (returns an EagerResult)
results = session.run(query)

# Convert EagerResult to a list of dictionaries
records = [record.data() for record in results]

# Define the CSV file path
csv_file = "cypher_report.csv"

# Open the CSV file in write mode
with open(csv_file, mode='w', newline='') as file:
    # Determine the fieldnames (columns) based on the keys in the first record
    if records:
        fieldnames = records[0].keys()
    else:
        fieldnames = []

    writer = csv.DictWriter(file, fieldnames=fieldnames)
    writer.writeheader()  # Write the header row
    
    # Write the results to the CSV file
    for record in records:
        writer.writerow(record)

print(f"CSV report generated: {csv_file}")

# Close the session and driver connection
session.close()
driver.close()
