Using REPORTS_TO

WITH ["L1managerid", "L2managerid", "L3managerid", "L4managerid"] AS levels
MATCH (n:User)
WHERE n.managerid IS NOT NULL

// Collect managers at different levels (L1, L2, L3, L4)
OPTIONAL MATCH (n)-[:REPORTS_TO*1..4]->(manager:User)
WITH n, manager, levels, 
     CASE WHEN size(collect(manager)) > 0 THEN collect(manager)[0].employeeNumber ELSE NULL END AS L1managerid,
     CASE WHEN size(collect(manager)) > 1 THEN collect(manager)[1].employeeNumber ELSE NULL END AS L2managerid,
     CASE WHEN size(collect(manager)) > 2 THEN collect(manager)[2].employeeNumber ELSE NULL END AS L3managerid,
     CASE WHEN size(collect(manager)) > 3 THEN collect(manager)[3].employeeNumber ELSE NULL END AS L4managerid

// Calculate the level based on the size of the collected managers
WITH n, L1managerid, L2managerid, L3managerid, L4managerid, 
     size(collect(manager)) + 1 AS Level

// Return the final report
RETURN n.employeeNumber AS employeeNumber, 
       n.managerid AS managerid, 
       Level,
       L1managerid, 
       L2managerid, 
       L3managerid, 
       L4managerid
ORDER BY n.employeeNumber

