To update **only the changed properties** in Neo4j (Entitlement node), you need a **dynamic Cypher query** that:

1. Matches the `entitlementName` and `targetSystem`.
2. Checks each field one-by-one.
3. Updates only if the property value differs from the incoming value.

Here‚Äôs a **parameterized Cypher template** that does exactly that:

---

### üîÅ **Cypher Query to Update Only Changed Properties**

```cypher
UNWIND $entitlements AS ent
MATCH (e:Entitlement {
    entitlementName: ent.entitlementName,
    targetSystem: ent.targetSystem
})
WITH e, ent
FOREACH (_ IN CASE WHEN e.description <> ent.description AND ent.description IS NOT NULL THEN [1] ELSE [] END |
    SET e.description = ent.description
)
FOREACH (_ IN CASE WHEN e.riskLevel <> ent.riskLevel AND ent.riskLevel IS NOT NULL THEN [1] ELSE [] END |
    SET e.riskLevel = ent.riskLevel
)
FOREACH (_ IN CASE WHEN e.priviledgedAccess <> ent.priviledgedAccess AND ent.priviledgedAccess IS NOT NULL THEN [1] ELSE [] END |
    SET e.priviledgedAccess = ent.priviledgedAccess
)
FOREACH (_ IN CASE WHEN e.entitlementType <> ent.entitlementType AND ent.entitlementType IS NOT NULL THEN [1] ELSE [] END |
    SET e.entitlementType = ent.entitlementType
)
```

---

### ‚úÖ **Why This Works**

* **`UNWIND`**: Iterates over each entitlement from your parameter.
* **`MATCH`**: Targets the correct `Entitlement` node.
* **`FOREACH` + `CASE`**: Neo4j‚Äôs trick to make conditional updates without APOC.

---

### üì¶ **Example Parameters to Pass from Python**

```python
entitlements = [
    {
        "entitlementName": "APP_CTX_READ",
        "targetSystem": "MySystem",
        "description": "Updated Description",
        "riskLevel": "High",
        "priviledgedAccess": "No",
        "entitlementType": "Read"
    },
    ...
]
```

You‚Äôd pass this list to the Cypher query using the `entitlements` parameter.

---

### ‚ö†Ô∏è Tips

* Ensure `None` in Python is passed as `null` to Neo4j ‚Äî or filtered out if you want to skip them entirely.
* Be careful with types: strings vs. integers vs. booleans.
* You can enhance this further using `apoc.do.when` if APOC is available, but the native version above is safe and portable.

---

Would you like me to help build the Python code that prepares this `entitlements` payload for Neo4j updates from the MySQL vs Neo4j diff?
