Perfect — if you want to use `UNWIND` to pass the DataFrame into Neo4j, here's exactly how to do it:

---

## ✅ Objective

Use `UNWIND` in Cypher to:

* Pass a list of `entitlementName` + `targetSystem` pairs from a pandas DataFrame.
* Fetch all matching `Entitlement` nodes.
* Fetch owners using `OPTIONAL MATCH`.
* Return entitlements and their owner `employeeNumber`s.

---

## ✅ Python Code Using `UNWIND`

```python
from neo4j import GraphDatabase
import pandas as pd

# Connect to Neo4j
driver = GraphDatabase.driver("bolt://localhost:7687", auth=("neo4j", "your_password"))

def fetch_entitlements_with_owners_unwind(df: pd.DataFrame):
    # Prepare a list of dictionaries for UNWIND
    entitlement_list = [
        {
            "entitlementName": row["entitlementName"],
            "targetSystem": row["targetSystem"]
        }
        for _, row in df.iterrows()
    ]

    cypher_query = """
    UNWIND $entitlements AS ent
    MATCH (e:Entitlement {entitlementName: ent.entitlementName, targetSystem: ent.targetSystem})
    OPTIONAL MATCH (e)-[:OWNER]->(u:User)
    RETURN e.entitlementName AS entitlementName,
           e.targetSystem AS targetSystem,
           e.description AS description,
           e.riskLevel AS riskLevel,
           e.priviledgedAccess AS priviledgedAccess,
           e.entitlementType AS entitlementType,
           collect(u.employeeNumber) AS owners
    """

    with driver.session() as session:
        result = session.run(cypher_query, {"entitlements": entitlement_list})
        return pd.DataFrame([record.data() for record in result])

# Example DataFrame (simulate MySQL input)
# df_mysql = pd.DataFrame({'entitlementName': [...], 'targetSystem': [...]})
# result_df = fetch_entitlements_with_owners_unwind(df_mysql)
# print(result_df)
```

---

## ✅ Why use `UNWIND`?

* Cleaner syntax when dealing with many rows.
* Avoids Cypher limitations on tuple `IN` clauses for large datasets.
* Neo4j can optimize `UNWIND` + `MATCH` better when properly indexed.

---

## ✅ Output

The returned DataFrame will contain:

| entitlementName | targetSystem | description | riskLevel | priviledgedAccess | entitlementType | owners          |
| --------------- | ------------ | ----------- | --------- | ----------------- | --------------- | --------------- |
| SomeName        | SystemA      | Desc...     | High      | Yes               | Role            | \['12345', ...] |
| AnotherEnt      | SystemB      | ...         | ...       | ...               | ...             | \[]             |

→ `owners` will be an empty list if no `User` nodes are linked.

---

Would you like help making this **batch-safe for 8.8 million rows**?
