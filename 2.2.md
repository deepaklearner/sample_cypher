import tracemalloc
import sys

def main():
    tracemalloc.start()
    try:
        # Your main logic here
        print("Running some memory-heavy code...")
        data = [x * 2 for x in range(100000)]

        # Simulate a conditional exit
        if len(data) > 0:
            print("Exiting with status 0")
            sys.exit(0)

    except Exception as e:
        print(f"Error occurred: {e}")
        sys.exit(1)

    finally:
        # Always stop tracemalloc, no matter what
        print("Stopping tracemalloc")
        tracemalloc.stop()

if __name__ == "__main__":
    main()
